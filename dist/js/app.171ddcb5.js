(function(e){function t(t){for(var r,a,c=t[0],s=t[1],d=t[2],l=0,p=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,d||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==o[s]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var u=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},2088:function(e,t,n){},"52f9":function(e,t,n){e.exports=n.p+"img/room.88e2a938.png"},"56d7":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"getSelf",(function(){return B})),n.d(r,"getPeers",(function(){return V})),n.d(r,"isConnected",(function(){return W})),n.d(r,"audioContext",(function(){return U}));var o={};n.r(o),n.d(o,"recieveMessage",(function(){return H})),n.d(o,"sendMessage",(function(){return X})),n.d(o,"initPeer",(function(){return Y})),n.d(o,"updateName",(function(){return Z})),n.d(o,"recieveName",(function(){return Q})),n.d(o,"updatePosition",(function(){return ee})),n.d(o,"recievePosition",(function(){return te})),n.d(o,"updateDirection",(function(){return ne})),n.d(o,"recieveDirection",(function(){return re})),n.d(o,"updatePointer",(function(){return oe})),n.d(o,"recievePointer",(function(){return ie})),n.d(o,"updateColor",(function(){return ae})),n.d(o,"recieveColor",(function(){return ce}));var i={};n.r(i),n.d(i,"requestAudioTrack",(function(){return me})),n.d(i,"requestVideoTrack",(function(){return ve})),n.d(i,"connectGroup",(function(){return he})),n.d(i,"disconnectGroup",(function(){return je})),n.d(i,"addPeer",(function(){return De})),n.d(i,"sessionDescription",(function(){return _e}));n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e.isConnected?e._e():n("Connect"),e.isConnected?n("Room"):e._e()],1)},s=[],d=(n("1c01"),n("58b2"),n("8e6e"),n("f3e2"),n("d25f"),n("ac6a"),n("456d"),n("bd86")),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("svg",{attrs:{id:"room",viewBox:e.viewBoxString}},[r("image",{staticStyle:{opacity:"0.5"},attrs:{href:n("52f9"),width:"800",x:"-400",y:"-250"}}),e._l(e.getPeers,(function(e){return r("Person",{attrs:{metadata:e}})})),r("Person",{attrs:{metadata:e.getSelf,isself:!0}})],2),r("div",{staticStyle:{position:"absolute",top:"0",left:"0"}},[e._v("\n\t\t\t"+e._s(JSON.stringify(e.getSelf))+"\n\t\t")])])},l=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("g",{class:{self:e.isself}},[n("text",{staticClass:"name",attrs:{"text-anchor":"middle",x:e.metadata.x,y:e.metadata.y+34}},[e._v(e._s(e.metadata.name))]),void 0!=e.pointer?n("g",{staticClass:"pointer",attrs:{transform:"translate("+e.metadata.x+", "+e.metadata.y+")"}},[n("g",{attrs:{transform:"rotate("+(180*e.pointer.angle/Math.PI+90)+")"}},[void 0!=e.metadata.pointer?n("path",{attrs:{d:"M0 0 l0 "+-e.pointer.distance,stroke:"#000000","stroke-width":"3","stroke-dasharray":"7 7"}}):e._e(),n("g",{attrs:{transform:"translate(-10, "+-e.pointer.distance+")"}},[n("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 70 74",fill:"none",xmlns:"http://www.w3.org/2000/svg"},on:{mousedown:e.startDragPointer}},[n("path",{attrs:{d:"M28.6695 4.41465L1.41385 62.1706C-1.39872 68.1306 5.0533 74.7979 11.3108 72.7302C18.9427 70.2082 27.7074 68 35 68C42.2926 68 51.0573 70.2082 58.6892 72.7302C64.9467 74.7979 71.3987 68.1306 68.5861 62.1706L41.3305 4.41464C38.8057 -0.935455 31.1943 -0.935448 28.6695 4.41465Z",fill:"black"}})])])])]):e._e(),n("g",{staticClass:"player",on:{mousedown:e.startDrag}},[n("circle",{attrs:{cx:e.metadata.x,cy:e.metadata.y,r:"20",fill:e.metadata.color,stroke:"#000000","stroke-width":"3"}}),n("g",{staticClass:"face"},[n("circle",{attrs:{cx:e.facePosition.x-4,cy:e.facePosition.y-2,r:"2",fill:"#000000"}}),n("circle",{attrs:{cx:e.facePosition.x+4,cy:e.facePosition.y-2,r:"2",fill:"#000000"}}),n("path",{attrs:{d:"M "+(e.facePosition.x-4)+" "+(e.facePosition.y+4)+" l 8 0",stroke:"#000000","stroke-width":"2"}})])])])},f=[],g=n("2f62"),m=function(e){var t=Object.assign({name:"",color:"#CCCCCC",tracks:{video:null,audio:null},angle:0,pointer:null,x:0,y:0},e);return console.log("PERSON",t,e),t},v=function(e,t){var n=t.y-e.y,r=t.x-e.x,o=Math.atan2(n,r);return o},h=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))};function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){Object(d["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={name:"Person",props:["metadata","isself"],data:function(){return{dragging:!1,localPointer:null,draggingPointer:!1}},computed:b({pointer:function(){return this.metadata.pointer||this.localPointer},facePosition:function(){return{x:this.metadata.x+10*Math.cos(this.metadata.angle),y:this.metadata.y+10*Math.sin(this.metadata.angle)}}},Object(g["b"])(["audioContext"])),mounted:function(){this.isself&&window.addEventListener("mousemove",this.mouseMove)},watch:{"metadata.tracks.audio":{immediate:!0,handler:function(e,t){void 0!=e&&e.constructor==MediaStreamTrack&&this.connectAudioSource(e)}}},methods:{connectAudioSource:function(e){if(!this.isself){var t=new MediaStream;t.addTrack(e);var n=this.audioContext.createMediaStreamSource(t);n.connect(this.audioContext.destination)}},mouseMove:function(e){var t=document.querySelector("#room"),n=void 0===e.buttons?1===e.which:1===e.buttons,r=t.createSVGPoint();r.x=e.clientX,r.y=e.clientY;var o=r.matrixTransform(t.getScreenCTM().inverse()),i=v(this.metadata,o);this.angle!=Math.round(10*i)/10&&this.$store.dispatch("updateDirection",Math.round(10*i)/10);var a=h(this.metadata,o);this.localPointer=a<140&&a>21?{distance:43,angle:i}:null,n&&this.dragging?this.$store.dispatch("updatePosition",{x:o.x,y:o.y}):this.dragging=!1,n&&this.draggingPointer?this.$store.dispatch("updatePointer",{distance:a,angle:i}):this.draggingPointer&&(this.draggingPointer=!1,this.$store.dispatch("updatePointer",null))},startDrag:function(){this.isself&&(this.dragging=!0)},startDragPointer:function(){this.isself&&(this.draggingPointer=!0)}}},P=O,w=(n("e6cd"),n("2877")),j=Object(w["a"])(P,p,f,!1,null,null,null),D=j.exports;function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(d["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k={name:"Room",computed:x({viewBoxString:function(){return"".concat(-this.width/2," ").concat(-this.height/2," ").concat(this.width," ").concat(this.height)}},Object(g["b"])(["getSelf","getPeers"])),data:function(){return{width:0,height:0}},mounted:function(){window.addEventListener("resize",this.getWindowSize),this.getWindowSize()},methods:{getWindowSize:function(){this.width=document.documentElement.clientWidth,this.height=document.documentElement.clientHeight}},components:{Person:D}},C=k,S=Object(w["a"])(C,u,l,!1,null,null,null),M=S.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{on:{submit:function(t){return t.preventDefault(),e.connect(t)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.groupID,expression:"groupID"}],attrs:{type:"text"},domProps:{value:e.groupID},on:{input:function(t){t.target.composing||(e.groupID=t.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),n("button",{attrs:{type:"submit"}},[e._v("connect")])])},E=[],A=(n("7f7f"),{name:"Room",data:function(){return{groupID:"test",name:"Talfa Ester"}},methods:{connect:function(){this.$store.dispatch("connectGroup",{groupID:this.groupID,name:this.name})}}}),I=A,N=Object(w["a"])(I,T,E,!1,null,null,null),R=N.exports;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(d["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G={name:"App",computed:$({},Object(g["b"])(["isConnected"])),components:{Room:M,Connect:R}},q=G,J=Object(w["a"])(q,c,s,!1,null,null,null),z=J.exports,B=function(e){return e.self},V=function(e){return e.peers},W=function(e){return e.connected},U=function(e){return e.audioContext};function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){Object(d["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=function(e,t){var n=e.dispatch,r=t.message,o=t.peer_id;n(r.type,{message:r,peer_id:o})},X=function(e,t){var n=e.state,r=t.message,o=t.peer_id;if(o)n.peers[o].data.send(JSON.stringify(r));else for(var i in n.peers)n.peers[i].data.send(JSON.stringify(r))},Y=function(e,t){var n=e.state,r=e.dispatch;r("sendMessage",{message:{type:"recieveName",name:n.self.name},peer_id:t}),r("sendMessage",{message:{type:"recieveColor",color:n.self.color},peer_id:t}),r("sendMessage",{message:{type:"recievePosition",x:n.self.x,y:n.self.y},peer_id:t}),r("sendMessage",{message:{type:"recieveDirection",angle:n.self.angle},peer_id:t})},Z=function(e,t){var n=e.commit,r=e.dispatch;r("sendMessage",{message:{type:"recieveName",name:t}}),n("setName",{name:t})},Q=function(e,t){var n=e.commit,r=t.message,o=t.peer_id;n("setName",{name:r.name,peer_id:o})},ee=function(e,t){var n=e.commit,r=e.dispatch;r("sendMessage",{message:K({type:"recievePosition"},t)}),n("setPosition",{point:t})},te=function(e,t){var n=e.commit,r=t.message,o=t.peer_id;n("setPosition",{point:r,peer_id:o})},ne=function(e,t){var n=e.commit,r=e.dispatch;r("sendMessage",{message:{type:"recieveDirection",angle:t}}),n("setDirection",{angle:t})},re=function(e,t){var n=e.commit,r=t.message,o=t.peer_id;n("setDirection",{angle:r.angle,peer_id:o})},oe=function(e,t){var n=e.commit,r=e.dispatch;r("sendMessage",{message:{type:"recievePointer",pointer:t}}),n("setPointer",{pointer:t})},ie=function(e,t){var n=e.commit,r=t.message,o=t.peer_id;n("setPointer",{pointer:r.pointer,peer_id:o})},ae=function(e,t){var n=e.commit,r=e.dispatch;r("sendMessage",{message:{type:"recieveColor",color:t}}),n("setColor",{color:t})},ce=function(e,t){var n=e.commit,r=t.message,o=t.peer_id;n("setColor",{color:r.color,peer_id:o})},se={updateAudioTrack:function(e,t){a["a"].set(e.self.tracks,"audio",t)},updateVideoTrack:function(e,t){a["a"].set(e.self.tracks,"audio",t)},setGroupID:function(e,t){void 0!=t?(a["a"].set(e,"groupID",t),a["a"].set(e,"connected",!0)):(a["a"].set(e,"groupID",""),a["a"].set(e,"connected",!1))},addPeer:function(e,t){console.log("ADDPEER",t.id,t.data);var n=m(t.data);console.log(t.id,n),a["a"].set(e.peers,t.id,n)},removePeer:function(e,t){t in e.peers&&(e.peers[t].connection.close(),a["a"].delete(e.peers,t))},addTrackToPeer:function(e,t){var n=t.peer_id,r=t.track;a["a"].set(e.peers[n].tracks,r.kind,r)},setName:function(e,t){var n=t.name,r=t.peer_id;r?a["a"].set(e.peers[r],"name",n):a["a"].set(e.self,"name",n)},setPosition:function(e,t){var n=t.point,r=t.peer_id;r?(a["a"].set(e.peers[r],"x",n.x),a["a"].set(e.peers[r],"y",n.y)):(a["a"].set(e.self,"x",n.x),a["a"].set(e.self,"y",n.y))},setDirection:function(e,t){var n=t.angle,r=t.peer_id;r?a["a"].set(e.peers[r],"angle",n):a["a"].set(e.self,"angle",n)},setPointer:function(e,t){var n=t.pointer,r=t.peer_id;r?a["a"].set(e.peers[r],"pointer",n):a["a"].set(e.self,"pointer",n)},setColor:function(e,t){var n=t.color,r=t.peer_id;r?a["a"].set(e.peers[r],"color",n):a["a"].set(e.self,"color",n)}},de=(n("d92a"),n("8055")),ue=n.n(de),le="https://cozyroom-signaling.herokuapp.com/",pe=[{url:"stun:stun.l.google.com:19302"}],fe=null,ge={},me=function(e){e.state;var t=e.commit;navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){var n=e.getAudioTracks()[0];for(var r in ge){var o=ge[r];o.connection.addTrack(n)}t("updateAudioTrack",n)}))},ve=function(e){e.state;var t=e.commit;navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(e){var n=e.getVideoTracks()[0];for(var r in ge){var o=ge[r];o.connection.addTrack(n)}t("updateVideoTrack",n)}))},he=function(e,t){fe=ue()(le),fe.on("connect",ye.bind(null,e,t)),fe.on("addPeer",be.bind(null,e)),fe.on("removePeer",Oe.bind(null,e)),fe.on("iceCandidate",Pe.bind(null,e)),fe.on("sessionDescription",we.bind(null,e))};function ye(e,t){var n=e.dispatch,r=e.commit,o=t.groupID,i=t.name;console.log("Connected to signaling server"),n("requestAudioTrack"),fe.emit("join",{channel:o}),r("setGroupID",o),n("updateName",i)}function be(e,t){var n=e.dispatch;n("addPeer",t)}function Oe(e,t){var n=e.commit;console.log("Signaling server said to remove peer:",t);var r=t.peer_id;n("removePeer",r)}function Pe(e,t){e.state;var n=ge[t.peer_id].connection,r=t.ice_candidate;n.addIceCandidate(new RTCIceCandidate(r))}function we(e,t){var n=e.dispatch;n("sessionDescription",t)}var je=function(e,t){e.state;var n=e.commit;for(peer_id in ge)ge[peer_id].connection.close();fe.emit("part",{channel:t}),fe=null,n("setGroupID",null)},De=function(e,t){var n=e.state,r=e.commit,o=e.dispatch;console.log("Signaling server said to add peer:",t);var i=t.peer_id;if(i in ge)console.log("Already connected to peer ",i);else{var a=new RTCPeerConnection({iceServers:pe},{optional:[{DtlsSrtpKeyAgreement:!0}]}),c=a.createDataChannel("general"),s={connection:a,data:c};r("addPeer",{id:i,data:s}),ge[i]=s,a.onicecandidate=function(e){e.candidate&&fe.emit("relayICECandidate",{peer_id:i,ice_candidate:{sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate}})},a.ontrack=function(e){console.log("Adding ".concat(e.track.kind," track with label ").concat(e.track.label)),r("addTrackToPeer",{peer_id:i,track:e.track})},void 0!=n.self.tracks.audio&&(console.log("SENDING AUDIO TRACK"),a.addTrack(n.self.tracks.audio)),void 0!=n.self.tracks.video&&a.addTrack(n.self.tracks.video),a.ondatachannel=function(e){var t=e.channel;t.onopen=function(e){o("initPeer",i)},t.onmessage=function(e){var t=JSON.parse(e.data);o("recieveMessage",{message:t,peer_id:i})}},t.should_create_offer&&(console.log("Creating RTC offer to ",i),a.createOffer((function(e){console.log("Local offer description is: ",e),a.setLocalDescription(e,(function(){fe.emit("relaySessionDescription",{peer_id:i,session_description:e}),console.log("Offer setLocalDescription succeeded")}),(function(){Alert("Offer setLocalDescription failed!")}))}),(function(e){console.log("Error sending offer: ",e)})))}},_e=function(e,t){e.state;console.log("Remote description received: ",t);var n=t.peer_id,r=ge[n].connection,o=t.session_description;console.log(t.session_description);var i=new RTCSessionDescription(o);r.setRemoteDescription(i,(function(){console.log("setRemoteDescription succeeded"),"offer"==o.type&&(console.log("Creating answer"),r.createAnswer((function(e){console.log("Answer description is: ",e),r.setLocalDescription(e,(function(){fe.emit("relaySessionDescription",{peer_id:n,session_description:e}),console.log("Answer setLocalDescription succeeded")}),(function(){Alert("Answer setLocalDescription failed!")}))}),(function(e){console.log("Error creating answer: ",e),console.log(r)})))}),(function(e){console.log("setRemoteDescription error: ",e)}));console.log("Description Object: ",i)},xe=n("fd9b");a["a"].use(g["a"]);var ke={audioContext:new AudioContext,connected:!1,groupID:"",self:m({color:Object(xe["randomColor"])()}),peers:{}},Ce=new g["a"].Store({state:ke,getters:r,actions:Object.assign({},o,i),mutations:se}),Se=n("9483");Object(Se["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),new a["a"]({store:Ce,render:function(e){return e(z)}}).$mount("#app")},e6cd:function(e,t,n){"use strict";var r=n("2088"),o=n.n(r);o.a}});
//# sourceMappingURL=app.171ddcb5.js.map